product:
  name: Red Hat iPaas
  abbreviation: Fuse-iPaaS
  stage: ${build.stage}
  issueTrackerUrl: https://github.com/syndesisio/syndesis/issues
version: ${version.fuse.prefix}
milestone: ${build.milestone}
group: Fuse iPaaS ${version.fuse.prefix}
defaultBuildParameters:
  environmentId: 7
  buildScript: 'mvn -e -V -B -DskipTests -DfailIfNoTests=false -Dtest=false clean
    deploy'

builds:
- name: atlasmap-1.39.6
  project: atlasmap/atlasmap
    #fetchScmUrl: ${atlasmap.fetch.scmUrl}
    #pushScmUrl: ${atlasmap.push.scmUrl}
    #tag: ${atlasmap.tag}
    #buildCommand: ${atlasmap.buildCommand}
    #externalScmUrl: git+https://code.engineering.redhat.com/gerrit/atlasmap/atlasmap.git
  scmUrl: git+ssh://code.stage.engineering.redhat.com/atlasmap/atlasmap.git
  scmRevision: atlasmap-${version.atlasmap}
  customPmeParameters:
    - '-DdependencyExclusion.com.sun.xml.bind:*@*='
    - '-DdependencyOverride.org.ow2.asm:*@*='
    - '-DprojectMetaSkip=true'
  buildScript: >
    export REG=http://mwnodereg.hosts.mwqe.eng.bos.redhat.com:49168

    sed -i \"s#https://registry.yarnpkg.com/#${REG}#g\" ui/yarn.lock

    sed -i 's#https:#http:#g' ui/yarn.lock

    mvn -e -V -B -DskipTests -DfailIfNoTests=false -pl '!ui,!standalone' -Dtest=false -Dgpg.skip=true -Prelease -DnpmRegistryURL2=$REG -DnpmDownloadRoot=http://download-node-02.eng.bos.redhat.com/rcm-guest/staging/fuse/npm/dist/npm/ -DyarnRegistry=$REG  -DyarnDownloadRoot=http://download-node-02.eng.bos.redhat.com/rcm-guest/staging/fuse/yarn/dist/ -DnodeDownloadRoot=http://download-node-02.eng.bos.redhat.com/rcm-guest/staging/fuse/npm/dist/   -DyarnInheritsProxyConfigFromMaven=false -Dyarn.install.args='--network-concurrency 30 --child-concurrency 2 --no-progress' -Dtest=false -Dgpg.skip=true -Prelease clean deploy

- name: syndesis-1.6.4
  project: syndesisio/syndesis
    #fetchScmUrl: ${syndesis.fetch.scmUrl}
    #pushScmUrl: ${syndesis.push.scmUrl}
    #tag: ${syndesis.tag}
    #buildCommand: ${syndesis.buildCommand}
    #externalScmUrl: git+https://code.engineering.redhat.com/gerrit/syndesisio/syndesis.git
  scmUrl: git+ssh://code.stage.engineering.redhat.com/syndesisio/syndesis.git
  scmRevision: syndesis-${version.syndesis}
  customPmeParameters:
    - '-DprojectMetaSkip=true'
    - '--file=app/pom.xml'
    - '-DdependencyExclusion.com.fasterxml.jackson.core:*@*='
    - '-DdependencyExclusion.com.fasterxml.jackson:*@*='
    - '-DdependencyExclusion.com.fasterxml.jackson.dataformat:*@*='
    - '-DdependencyExclusion.com.fasterxml.jackson.datatype:*@*='
    - '-DdependencyExclusion.com.fasterxml.jackson.module:*@*='
  buildScript: > 
    export MAVEN_OPTS=\"-Xmx2048m\"

    export PUPPETEER_SKIP_CHROMIUM_DOWNLOAD

    export REG=http://mwnodereg.hosts.mwqe.eng.bos.redhat.com:49195

    sed -i \"s#resolved \"https:\/\/registry.yarnpkg.com\/#resolved \"${REG}\/#g\" app/ui/yarn.lock

    sed -i \"s#resolved \"http:\/\/registry.npmjs.org\/#resolved \"${REG}\/#g\" app/ui/yarn.lock

    sed -i \"s#https:#http:#g\" app/ui/yarn.lock

    mvn -e -V -B -DskipTests -DfailIfNoTests=false -Dtest=false -DnpmRegistryURL2=$REG -DnpmDownloadRoot=http://download-node-02.eng.bos.redhat.com/rcm-guest/staging/fuse/npm/dist/npm/ -DyarnRegistry=$REG -DyarnDownloadRoot=http://download-node-02.eng.bos.redhat.com/rcm-guest/staging/fuse/yarn/dist/ -DnodeDownloadRoot=http://download-node-02.eng.bos.redhat.com/rcm-guest/staging/fuse/npm/dist/ -Dsass-binary-site=http://download-node-02.eng.bos.redhat.com/rcm-guest/staging/fuse/npm/node-sass -DyarnInheritsProxyConfigFromMaven=false clean deploy -f app/pom.xml
  dependencies:
  - atlasmap-1.39.6

outputPrefixes:
  releaseFile: ipaas-test
  releaseDir: ipaas-test
flow:
  #licensesGeneration: gen.downloadFrom 'karaf' matching '.*license\.zip'
  #licensesGeneration: gen.generate()
  #repositoryGeneration: gen.downloadFrom 'karaf' matching '.*-m2repo\.zip'
  #javadocGeneration: gen.downloadFrom 'karaf' matching '.*javadoc\.zip'
  #addons:
  #runtimeDependenciesAnalyzer:
  #  downloadFrom: 'WildFly-Swarm'
  #  matching: '.*runtime-dependencies\.zip'
  #  referenceBuild: 'WildFly-Swarm'
